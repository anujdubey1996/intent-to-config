apiVersion: apps/v1
kind: Deployment
metadata:
  name: prometheus-operator
  labels:
    app: prometheus-operator
spec:
  replicas: 1
  selector:
    matchLabels:
      app: prometheus-operator
  template:
    metadata:
      labels:
        app: prometheus-operator
    spec:
      containers:
      - name: prometheus-operator
        image: quay.io/prometheus/prometheus-operator:v2.32.3
        args:
          - --config.path=prometheus.yml
          - --alertmanager.path=alertmanager.yml
        port: 9090
        resources:
          requests:
            cpu: 200m
            memory: 200Mi
        livenessProbe:
          httpGet:
            path: /api/v1/health?readiness=true
            port: 9090
        readinessProbe:
          httpGet:
            path: /api/v1/ready
            port: 9090
        command: ["prometheus"]
        envFrom:
        - configMapRef:
            name: prometheus-config
        securityContext:
          privileged: false
          runAsUser: 10001

        networkPolicy:
          podSelector:
            matchLabels:
              app: prometheus-operator
          policyTypes:
          - Ingress
          - Egress
          podSelector: {}
          ingress:
          - from:
            - podSelector:
                matchLabels:
                  app: prometheus-operator
          egress:
          - to:
            - podSelector:
                matchLabels:
                  app: kubernetes