apiVersion: apps/v1
kind: Deployment
metadata:
  name: kao-service-deployment
  namespace: kao
  labels:
    app: kao-service
spec:
  replicas: 1
  selector:
    matchLabels:
      app: kao-service
  template:
    metadata:
      labels:
        app: kao-service
    spec:
      serviceAccountName: kao-service-sa

      containers:
      - name: kao-service
        image: registry.example.com/kao-service:latest
        ports:
          - name: http
            containerPort: 8777
        env:
        - name: KAO_CONSUMER_API_KEY
          value: "XXX"
        - name: KAO_CONSUMER_SECRET
          value: "YYY"
        - name: DAPR_HTTP_PORT
          value: "8043"
        - name: DAPR_GRPC_PORT
          value: "8044"
        # Add Tracing and Logging configurations in JSON format
        command: ["/bin/sh"]
        command:
          - -c
          - |
            export DAPR_LOGGING_LAYOUT= json
            export DAPR_LOGGING_OPTIONS='{"outputType":"stdout","level":"info","appender":{"type":"logfmt","fields":["level","timestamp","logger","message"]}}'
            export DAPR_TRACING_EXPORTER_OTLP="otlp://localhost:4318"
            exec /usr/local/bin/kao-service
      readinessProbe:
        httpGet:
          path: /healthz
          port: 8777
      livenessProbe:
        httpGet:
          path: /healthz
          port: 8777
      resources:
        requests:
          cpu: 100m
          memory: 128Mi
        limits:
          cpu: 500m
          memory: 512Mi