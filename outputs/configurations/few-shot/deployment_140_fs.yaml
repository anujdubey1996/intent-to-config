apiVersion: apps/v1
kind: Deployment
metadata:
  name: s3-reader
  labels:
    app: s3-reader
spec:
  replicas: 1
  selector:
    matchLabels:
      app: s3-reader
  template:
    metadata:
      labels:
        app: s3-reader
    spec:
      containers:
      - name: s3-reader
        image: amazon/aws-cli
        env:
          - name: AWS_ACCESS_KEY_ID
            valueFrom:
              secretKeyRef:
                name: aws-s3-reader-sa
                key: accessKey
          - name: AWS_SECRET_ACCESS_KEY
            valueFrom:
              secretKeyRef:
                name: aws-s3-reader-sa
                key: secretKey
        command: ["sleep"]
        args: ["3600"] # Keep the container running for one hour
      serviceAccountName: s3-reader-sa

---
apiVersion: v1
kind: ServiceAccount
metadata:
  name: s3-reader-sa
  secrets:
  - name: aws-s3-reader-sa

---
apiVersion: v1
kind: Secret
metadata:
  name: aws-s3-reader-sa
type: OAuth2ClientCredential
data:
  clientID: <Your AWS OAuth2 Client ID>
  clientSecret: <Your AWS OAuth2 Client Secret>
  token: <Your AWS OAuth2 Token>