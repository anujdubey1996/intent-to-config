apiVersion: apps/v1
kind: Deployment
metadata:
  name: consul-service
  namespace: consul
  labels:
    app: consul
    tier: backend
  annotations:
    # This annotation indicates that the deployment should be rolled out gradually
    rollout.knative.dev/max-surge: "1"
    # This annotation sets the deployment's revision history limit
    revision.knative.dev/max-history: "5"
spec:
  replicas: 1
  selector:
    matchLabels:
      app: consul
  template:
    metadata:
      labels:
        app: consul
        tier: backend
    spec:
      serviceAccountName: default
      terminationGracePeriodSeconds: 30
      containers:
        - name: consul-container
          image: hashicorp/consul:1.11.2
          ports:
            - name: consul-dns
              containerPort: 8600
            - name: consul-http
              containerPort: 8500
          env:
            - name: CONSUL_LAN_IP
              value: "10.0.0.1"
            # Add more environment variables as needed
          command: ["consul", "agent", "-server", "-bootstrap", "-client=0.0.0.0"]
          resources:
            requests:
              memory: 8Mi
              cpu: 500m
            limits:
              memory: 32Mi
              cpu: 1000m