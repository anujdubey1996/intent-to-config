apiVersion: apps/v1
kind: Deployment
metadata:
  name: auth-server
  labels:
    app: auth-server
  annotations:
    app.kubernetes.io/instance: auth-server
spec:
  selector:
    matchLabels:
      app: auth-server
  template:
    metadata:
      annotations:
        app.kubernetes.io/instance: auth-server
    spec:
      serviceAccountName: auth-server-sa
      securityContext:
        fsGroup: 9999
        runAsUser: 1000
      containers:
      - name: auth-server
        image: auth-server:v3
        env:
        - name: JWT_SECRET
          value: my_jwt_secret
        ports:
        - name: auth
          containerPort: 8080
        volumeMounts:
        - mountPath: /config
          name: config-volume
      volumes:
      - name: config-volume
        configMap:
          name: auth-server-config
  spec:
    replicas: 1
    strategy:
      type: RollingUpdate
      rollingUpdate:
        maxUnavailable: 0
        maxSurge: 1
    selector:
      matchLabels:
        app: auth-server
    template:
      metadata:
        labels:
          app: auth-server
      spec:
        containers:
        - name: auth-server
          image: auth-server:v3
          env:
          - name: JWT_SECRET
            value: my_jwt_secret
          ports:
          - name: auth
            containerPort: 8080
          volumeMounts:
          - mountPath: /config
            name: config-volume
        serviceAccountName: auth-server-sa
        securityContext:
          fsGroup: 9999
          runAsUser: 1000
        volumes:
        - name: config-volume
          configMap:
            name: auth-server-config