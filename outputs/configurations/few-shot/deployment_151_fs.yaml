apiVersion: apps/v1
kind: Deployment
metadata:
  name: cert-controller-deployment
  namespace: cert-manager
spec:
  replicas: 1
  selector:
    matchLabels:
      app: cert-controller
  template:
    metadata:
      labels:
        app: cert-controller
    spec:
      serviceAccountName: cert-controller-sa
      containerSecurityContext:
        runAsUser: 1000
        capabilities:
          drop: ALL
      terminationGracePeriodSeconds: 30
      containers:
      - name: cert-controller
        image: jetstack/cert-manager:v1.6.0
        imagePullPolicy: IfNotPresent
        ports:
        - name: webhooks-port
          containerPort: 80
        env:
        - name: POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: POD_NAMESPACE
          valueFrom:
            fieldRef:
              fieldPath: metadata.namespace
        args:
        - CertController
        - --install
        - --webhook-service-cert-signature-key=cert-manager
        - --webhooks= certificate.acme.zero-dns.vercel.com:/certificate-manager/acme/challenge
        readinessProbe:
          httpGet:
            path: /healthz
            port: webhooks-port
        livenessProbe:
          httpGet:
            path: /healthz
            port: webhooks-port