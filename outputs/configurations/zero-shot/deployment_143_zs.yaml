apiVersion: v1
kind: ConfigMap
metadata:
  name: vault-config
  labels:
    app: instascan-vault
data:
  vault.conf: |
    UI=true
    api_addr=http://192.168.0.168:8200
    cluster_address=http://192.168.0.168:8201
    enable_api=true
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: instascan-vault
  labels:
    app: instascan-vault
spec:
  replicas: 1
  selector:
    matchLabels:
      app: instascan-vault
  template:
    metadata:
      labels:
        app: instascan-vault
    spec:
      containers:
      - name: instascan-vault
        image: hashicorp/vault:1.6.2
        env:
        - name: VAULT_ADDR
          value: http://vault:8200
        volumeMounts:
        - name: config-volume
          mountPath: /etc/vault/vault.d
        ports:
        - containerPort: 8200
          name: http
        - containerPort: 8201
          name: tcp
        - containerPort: 8202
          name: ssl
        volumeClaimTemplate:
          storageClass: fast
          accessModes: [ReadWriteMany]
          resources:
            requests:
              storage: 10Gi
      volumes:
      - name: config-volume
        configMap:
          name: vault-config